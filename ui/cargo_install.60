/* Copyright Â© 2021 SixtyFPS GmbH <info@sixtyfps.info>
 * SPDX-License-Identifier: MIT OR Apache-2.0
 */

import {
    ComboBox, VerticalBox, HorizontalBox, GridBox, Button,
    LineEdit, ListView, GroupBox, CheckBox
} from "sixtyfps_widgets.60";

import { Action } from "cargo.60";

export struct InstalledCrate := {
    name: string,
    version: string,
    // when not null, this is the version to upgrate to
    new_version: string,
    queued: bool,
}

export global CargoInstallData := {
    callback upgrade_all();
    callback upgrade(string);
    callback uninstall(string);
    property<[InstalledCrate]> crates;
}

export CargoInstallView := GridBox {
    Row {
        Text {
            text: "Currently installed packages";
            horizontal-stretch: 1;
            vertical-alignment: center;
        }
        Button {
            text: "ðŸ”„ Upgrade all";
            clicked => { CargoInstallData.upgrade_all() }
        }
    }
    ListView {
        colspan: 2;
        for crate in CargoInstallData.crates: HorizontalBox {
            crate_name := Text {
                text: {crate.name};
                vertical-alignment: center;
            }
            Text {
                text: {crate.version};
                vertical-alignment: center;
                color: crate.new_version == "" ? crate_name.color : red;
            }
            Rectangle {  }
            if (crate.new_version != "") : Button {
                text: "ðŸ”„ Upgrade to " + crate.new_version;
                clicked => {
                    crate.queued = true;
                    CargoInstallData.upgrade(crate.name);
                }
                enabled: !crate.queued;
            }
            Button {
                text: "ðŸ—‘ï¸ Uninstall";
                clicked => {
                    crate.queued = true;
                    CargoInstallData.uninstall(crate.name);
                }
                enabled: !crate.queued;
            }
        }
    }
}